{"version":3,"file":"_server.ts-6b6227a7.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/dataFromDevices/_server.ts.js"],"sourcesContent":["import { p as pb } from \"../../../../chunks/pocketbase.js\";\nconst POCKETBASE_API_ID = \"1u8lfP83zI2kKFvJZOvA\";\nconst POCKETBASE_API_PASSWD = \"pkrH7zKX55tVh6Pq\";\nconst POST = async ({ request }) => {\n  await pb.collection(\"users\").authWithPassword(POCKETBASE_API_ID, POCKETBASE_API_PASSWD);\n  let payloadFromDevice = {};\n  let deviceData = await request.json();\n  let arrayOfBytesBIN = [];\n  let arrayOfGNGLL = [];\n  deviceData.payload = deviceData.payload.replace(/\\s/g, \"\");\n  const arrayOfBytesString = deviceData.payload.match(/.{1,8}/g);\n  arrayOfBytesString?.forEach(function(value) {\n    arrayOfBytesBIN.push(Number(\"0b\".concat(value)));\n  });\n  payloadFromDevice.ID = arrayOfBytesBIN[0];\n  payloadFromDevice.battery = arrayOfBytesBIN[50];\n  payloadFromDevice.temperature = arrayOfBytesBIN[51];\n  arrayOfBytesBIN.splice(51, 1);\n  arrayOfBytesBIN.splice(50, 1);\n  arrayOfBytesBIN.splice(0, 1);\n  arrayOfBytesBIN.forEach(function(value) {\n    arrayOfGNGLL.push(String.fromCharCode(value));\n  });\n  const GNGLLmessageparsedByComma = arrayOfGNGLL.join(\"\").split(\",\");\n  const record = await pb.collection(\"devices\").getFullList(1, { filter: \"deviceID = \".concat(payloadFromDevice.ID.toString()) });\n  console.log();\n  payloadFromDevice.GNGLL = {\n    header: GNGLLmessageparsedByComma[0],\n    lat: Number(GNGLLmessageparsedByComma[1].replace(\".\", \"\")) / 1e6,\n    latDir: GNGLLmessageparsedByComma[2],\n    lon: Number(GNGLLmessageparsedByComma[3].replace(\".\", \"\")) / 1e6,\n    lonDir: GNGLLmessageparsedByComma[4],\n    utc: Number(GNGLLmessageparsedByComma[5]),\n    dataStatus: GNGLLmessageparsedByComma[6],\n    modeInd: GNGLLmessageparsedByComma[7]\n  };\n  const data = {\n    \"device\": record[0].id,\n    \"latitude\": payloadFromDevice.GNGLL.lat,\n    \"longitude\": payloadFromDevice.GNGLL.lon,\n    \"bat\": payloadFromDevice.battery,\n    \"time\": deviceData.rcvTime,\n    \"temp\": payloadFromDevice.temperature\n  };\n  try {\n    const record2 = await pb.collection(\"devicesData\").create(data);\n    pb.authStore.clear();\n    return new Response(void 0, { status: 200 });\n  } catch (error) {\n    return new Response(JSON.stringify(error), { status: 400 });\n  }\n  return new Response(void 0, { status: 200 });\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}